{% extends "base.html" %}

{% block title %}Media Admin - Dr. Guli Bekmurodovna{% endblock %}

{% block content %}

<!-- HERO / HEADER -->
<section class="dashboard-hero">
  <div class="dashboard-hero-overlay"></div>
  <div class="container scroll-reveal">
    <div class="row dashboard-layout align-items-center gy-4">
      <div class="col-lg-7">
        <div class="d-flex align-items-center gap-3 mb-3">
          <div class="dash-avatar-frame">
            <img
              src="{{ url_for('static', filename='images/dr-guli.png') }}"
              alt="Dr. Guli"
              loading="lazy"
            >
          </div>
          <div>
            <p class="tiny text-uppercase letter-spacing-wide text-muted mb-1">
              <span class="dashboard-text">media_admin_title</span>
            </p>
            <h1 class="h3 fw-semibold mb-2">
              <span class="dashboard-text">media_admin</span>
            </h1>
            <p class="text-muted mb-0 small">
              <span class="dashboard-text">media_admin_description</span>
            </p>
          </div>
        </div>
      </div>
      <div class="col-lg-5">
        <!-- you can add small stats here later if you want -->
      </div>
    </div>
  </div>
</section>

<!-- MAIN CONTENT -->
<section class="media-admin-shell py-5">
  <div class="container">
    <div class="media-admin-grid">

      <!-- LEFT: ADD / EDIT FORM (glass card) -->
      <div class="media-admin-form glass-card scroll-reveal">
        <div class="d-flex justify-content-between align-items-start mb-3">
          <div>
            <p class="tiny text-uppercase letter-spacing-wide text-muted mb-1">
              {% if edit_item %}
                <span class="dashboard-text">media_edit_item</span>
              {% else %}
                <span class="dashboard-text">media_add_new</span>
              {% endif %}
            </p>
            <h2 class="h5 mb-1">
              {% if edit_item %}
                <span class="dashboard-text">media_edit_item</span>
              {% else %}
                <span class="dashboard-text">media_add_new</span>
              {% endif %}
            </h2>
            <p class="tiny text-muted mb-0">
              <span class="dashboard-text">media_form_hint</span>
            </p>
          </div>

          {% if edit_item %}
            <a
              href="{{ url_for('manage_media', lang=lang) }}"
              class="btn btn-sm btn-outline-secondary rounded-pill"
            >
              <span class="dashboard-text">cancel</span>
            </a>
          {% endif %}
        </div>

        <form method="POST" action="{{ url_for('manage_media', lang=lang) }}" class="small">
          {% if edit_item %}
            <input type="hidden" name="id" value="{{ edit_item['id'] }}">
          {% endif %}

          <!-- TYPE -->
          <div class="mb-3">
            <label class="form-label tiny text-uppercase letter-spacing-wide">
              <span class="dashboard-text">media_type</span>
            </label>
            <div class="d-flex flex-wrap gap-2">
              {% set current_type = (edit_item['type'] if edit_item else 'magazine') %}
              <label class="media-type-chip">
                <input
                  type="radio"
                  name="type"
                  value="magazine"
                  {% if current_type == 'magazine' %}checked{% endif %}
                >
                <span class="chip-label dashboard-text">magazine</span>
              </label>
              <label class="media-type-chip">
                <input
                  type="radio"
                  name="type"
                  value="podcast"
                  {% if current_type == 'podcast' %}checked{% endif %}
                >
                <span class="chip-label dashboard-text">podcast</span>
              </label>
              <label class="media-type-chip">
                <input
                  type="radio"
                  name="type"
                  value="radio"
                  {% if current_type == 'radio' %}checked{% endif %}
                >
                <span class="chip-label dashboard-text">radio</span>
              </label>
              <label class="media-type-chip">
                <input
                  type="radio"
                  name="type"
                  value="video"
                  {% if current_type == 'video' %}checked{% endif %}
                >
                <span class="chip-label dashboard-text">video</span>
              </label>
            </div>
          </div>

          <!-- TITLES -->
          <div class="mb-3">
            <label class="form-label tiny text-uppercase letter-spacing-wide">
              <span class="dashboard-text">media_titles</span>
            </label>
            <div class="row g-2">
              <div class="col-12">
                <input
                  type="text"
                  name="title_en"
                  class="form-control form-control-sm"
                  placeholder="en"
                  value="{{ edit_item['title_en'] if edit_item else '' }}"
                  required
                >
              </div>
              <div class="col-6">
                <input
                  type="text"
                  name="title_uz"
                  class="form-control form-control-sm"
                  placeholder="uz"
                  value="{{ edit_item['title_uz'] if edit_item else '' }}"
                >
              </div>
              <div class="col-6">
                <input
                  type="text"
                  name="title_ru"
                  class="form-control form-control-sm"
                  placeholder="ru"
                  value="{{ edit_item['title_ru'] if edit_item else '' }}"
                >
              </div>
            </div>
          </div>

          <!-- DESCRIPTIONS -->
          <div class="mb-3">
            <label class="form-label tiny text-uppercase letter-spacing-wide">
              <span class="dashboard-text">media_descriptions</span>
            </label>
            <textarea
              name="description_en"
              class="form-control form-control-sm mb-2"
              rows="2"
              placeholder="en"
            >{{ edit_item['description_en'] if edit_item else '' }}</textarea>
            <div class="row g-2">
              <div class="col-6">
                <textarea
                  name="description_uz"
                  class="form-control form-control-sm"
                  rows="2"
                  placeholder="uz"
                >{{ edit_item['description_uz'] if edit_item else '' }}</textarea>
              </div>
              <div class="col-6">
                <textarea
                  name="description_ru"
                  class="form-control form-control-sm"
                  rows="2"
                  placeholder="ru"
                >{{ edit_item['description_ru'] if edit_item else '' }}</textarea>
              </div>
            </div>
          </div>

          <!-- LINK -->
          <div class="mb-3">
            <label class="form-label tiny text-uppercase letter-spacing-wide">
              <span class="dashboard-text">media_link</span>
            </label>
            <input
              type="url"
              name="link"
              class="form-control form-control-sm"
              placeholder="https://..."
              value="{{ edit_item['link'] if edit_item else '' }}"
            >
          </div>

          <div class="d-flex justify-content-end gap-2 mt-3">
            {% if edit_item %}
              <a
                href="{{ url_for('manage_media', lang=lang) }}"
                class="btn btn-sm btn-outline-secondary rounded-pill"
              >
                <span class="dashboard-text">cancel</span>
              </a>
            {% endif %}
            <button type="submit" class="btn btn-sm btn-primary rounded-pill px-3">
              {% if edit_item %}
                <span class="dashboard-text">save</span>
              {% else %}
                <span class="dashboard-text">media_add_new</span>
              {% endif %}
            </button>
          </div>
        </form>
      </div>

      <!-- RIGHT: MEDIA ITEMS LIST (cards) -->
      <div class="media-admin-list glass-card scroll-reveal">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <p class="tiny text-uppercase letter-spacing-wide text-muted mb-1">
              <span class="dashboard-text">media_existing_items</span>
            </p>
            <h2 class="h5 mb-0">
              <span class="dashboard-text">media_title</span>
            </h2>
          </div>
        </div>

        {% if items %}
          <div class="media-admin-items">
            {% for item in items %}
              <article class="media-admin-item">
                <div class="media-admin-item-header">
                  <div class="d-flex align-items-center gap-2">
                    <div class="media-icon-circle">
                      {% if item['type'] == 'podcast' %}
                        <i class="bi bi-mic"></i>
                      {% elif item['type'] == 'radio' %}
                        <i class="bi bi-broadcast-pin"></i>
                      {% elif item['type'] == 'video' %}
                        <i class="bi bi-play-fill"></i>
                      {% else %}
                        <i class="bi bi-journal-text"></i>
                      {% endif %}
                    </div>
                    <span class="media-badge
                      {% if item['type'] == 'podcast' %}media-badge--podcast
                      {% elif item['type'] == 'video' %}media-badge--video
                      {% else %}media-badge--article{% endif %}">
                      {% if item['type'] == 'podcast' %}
                        <span class="dashboard-text">podcast</span>
                      {% elif item['type'] == 'radio' %}
                        <span class="dashboard-text">radio</span>
                      {% elif item['type'] == 'video' %}
                        <span class="dashboard-text">video</span>
                      {% else %}
                        <span class="dashboard-text">magazine</span>
                      {% endif %}
                    </span>
                  </div>
                  <div class="tiny text-muted">
                    {{ item['created_at'] }}
                  </div>
                </div>

                <div class="media-admin-item-body">
                  <h3 class="media-admin-title">
                    {{ item['title_en'] }}
                  </h3>
                  {% if item['title_uz'] %}
                    <p class="tiny text-muted mb-1">
                      {{ item['title_uz'] }}
                    </p>
                  {% endif %}
                  {% if item['description_en'] %}
                    <p class="tiny text-muted mb-0">
                      {{ item['description_en']|truncate(140, True, 'â€¦') }}
                    </p>
                  {% endif %}
                </div>

                <div class="media-admin-item-footer">
                  <div class="small text-muted">
                    {% if item['link'] %}
                      <a href="{{ item['link'] }}" target="_blank" rel="noopener" class="tiny">
                        <span class="dashboard-text">view</span>
                      </a>
                    {% else %}
                      <span class="tiny text-muted">
                        <span class="dashboard-text">no_link</span>
                      </span>
                    {% endif %}
                  </div>
                  <div class="d-flex gap-2">
                    <a
                      href="{{ url_for('manage_media', lang=lang, media_id=item['id']) }}"
                      class="btn btn-xs btn-outline-primary rounded-pill"
                    >
                      <span class="dashboard-text">edit</span>
                    </a>
                    <form
                      method="POST"
                      action="{{ url_for('delete_media', media_id=item['id']) }}"
                      onsubmit="return confirm('Delete this media item?');"
                      style="display:inline;"
                    >
                      <button type="submit" class="btn btn-xs btn-outline-danger rounded-pill">
                        <span class="dashboard-text">delete</span>
                      </button>
                    </form>
                  </div>
                </div>
              </article>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted small mb-0">
            <span class="dashboard-text">media_no_items</span>
          </p>
        {% endif %}
      </div>
    </div>
  </div>
</section>

{% endblock %}
